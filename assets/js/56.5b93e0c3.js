(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{348:function(t,s,a){"use strict";a.r(s);var e=a(2),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"概览"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概览","aria-hidden":"true"}},[t._v("#")]),t._v(" 概览")]),t._v(" "),a("p",[t._v("存储安全规则用于确定哪些人对云存储桶中存储的文件拥有读取和写入权限，也可用于文件中包含的元数据校验。规则通过 "),a("code",[t._v("json")]),t._v(" 来描述，允许在满足条件时允许 "),a("code",[t._v("read")]),t._v(" 及 "),a("code",[t._v("write")]),t._v(" 操作，示例配置如下：")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"read"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("boolean")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" condition expression "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v("json")]),t._v(" 配置的 "),a("code",[t._v("key")]),t._v("，是用户的"),a("strong",[t._v("操作类型")]),t._v("，"),a("code",[t._v("value")]),t._v(" 是一个表达式。当表达式执行结果的值是 "),a("code",[t._v("true")]),t._v(" 的时候，用户的操作允许执行；否则，用户的操作则不被允许。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("操作类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("说明")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("默认值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("read")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("读取文件，例如：download")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("false")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("write")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("上传/覆盖文件，删除文件")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("false")])])])]),t._v(" "),a("p",[t._v("规则验证所依据的上下文通过 "),a("code",[t._v("auth")]),t._v("、"),a("code",[t._v("resource")]),t._v(" 对象获得，其提供可验证身份的上下文信息（"),a("code",[t._v("auth.uid")]),t._v("）和对象所有权（"),a("code",[t._v("resource.openid")]),t._v("）等信息。")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"read"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"auth.uid == resource.openid"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"write"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"auth != null"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("如需详细了解 Storage 安全规则，请参阅"),a("a",{attrs:{href:"/2020-01-09-storage-secure-resource"}},[t._v("保障文件安全")]),t._v("部分。")]),t._v(" "),a("h2",{attrs:{id:"示例规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例规则","aria-hidden":"true"}},[t._v("#")]),t._v(" 示例规则")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("注意")]),t._v("：发布之前，请务必评估你的规则，确保它们可以为你的应用提供所需的最高级别的安全性。如果发布应用时设置的是 "),a("code",[t._v("public")]),t._v(" 规则，可能会导致你存储的数据遭到意外访问或未经授权的访问。若设置的是 "),a("code",[t._v("default")]),t._v(" 规则，可能导致你的数据无法被管理员外的用户访问。")])]),t._v(" "),a("p",[t._v("存储安全规则以存储桶为控制边界，默认规则下不允许任何非管理端的资源访问，未实现基础的权限控制，可以根据需求设置如下的安全规则：")]),t._v(" "),a("h3",{attrs:{id:"所有用户可读，仅创建者及管理员可写"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#所有用户可读，仅创建者及管理员可写","aria-hidden":"true"}},[t._v("#")]),t._v(" 所有用户可读，仅创建者及管理员可写")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"read"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"write"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"resource.openid == auth.openid"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 登录方式为微信")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"write"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"resource.openid == auth.uid"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 登录方式为非微信")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"仅创建者及管理员可读写"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#仅创建者及管理员可读写","aria-hidden":"true"}},[t._v("#")]),t._v(" 仅创建者及管理员可读写")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"read"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"resource.openid == auth.openid"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//登录方式为微信")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"read"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"resource.openid == auth.uid"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 登录方式为非微信")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"write"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"resource.openid == auth.openid"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//登录方式为微信")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"write"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"resource.openid == auth.uid"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 登录方式为非微信")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"所有用户可读，仅管理员可写"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#所有用户可读，仅管理员可写","aria-hidden":"true"}},[t._v("#")]),t._v(" 所有用户可读，仅管理员可写")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"read"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"write"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"仅管理员可读写"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#仅管理员可读写","aria-hidden":"true"}},[t._v("#")]),t._v(" 仅管理员可读写")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"read"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"write"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("在开发期间，您可以使用公开规则代替默认规则，将您的文件设置为可公开读写。这对于原型设计非常有用，但在上线前一定评估当前规则是否合适，否则可能带来越权的访问。")]),t._v(" "),a("p",[t._v("用户规则允许您向每个已经过身份验证的用户提供单独的个人文件存储。您也可以使用不公开规则来完全锁定您的文件，不过请注意，如果您使用此类规则，您的用户将无法在"),a("strong",[t._v("客户端")]),t._v("读取或写入任何内容。通过"),a("strong",[t._v("服务端")]),t._v("或"),a("strong",[t._v("控制台")]),t._v("访问文件的用户不会受到影响。")]),t._v(" "),a("h2",{attrs:{id:"修改规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改规则","aria-hidden":"true"}},[t._v("#")]),t._v(" 修改规则")]),t._v(" "),a("p",[t._v("云开发提供了一种简便的方式，你可以在云开发控制台，云存储模块的权限控制中查看和修改当前存储桶的权限管理。你可以选择由基础权限控制转为使用安全规则权限控制，修改更新安全规则，每次保存后规则会部署到存储服务器中，不过权限的更新可能不会立即完成，需要 1-3 分钟来生效。")]),t._v(" "),a("p",[t._v("你可以参阅"),a("a",{attrs:{href:"/2020-01-09-storage-secure-resource"}},[t._v("保障文件安全")]),t._v("，详细了解基于文件的安全机制的工作原理。也可以参阅"),a("a",{attrs:{href:"/2020-01-09-storage-user-secure"}},[t._v("用户安全性")]),t._v("部分，了解基于用户的安全机制。")])])}),[],!1,null,null,null);s.default=n.exports}}]);